#when profiling, uncomment this line
#_ZSH_PROFILE=1

if [ $_ZSH_PROFILE ]; then
  zmodload zsh/zprof
fi

#ensure path arrays do not contain duplicates
typeset -gU cdpath fpath mailpath path PATH

OLDPATH=$PATH
export PATH=$HOME/bin:$HOME/.local/bin:/usr/local/bin:/usr/local/sbin


fpath=(~/.zsh/completion $fpath)

source $HOME/.zshrc-helpers

prepend_path /home/linuxbrew/.linuxbrew/bin
prepend_path /usr/local/opt/coreutils/libexec/gnubin
prepend_path $HOME/.toolbox/bin
append_path  "/Applications/Visual Studio Code.app/Contents/Resources/app/bin"
prepend_manpath /usr/local/opt/coreutils/libexec/gnuman
append_path $HOME/.cargo/bin
append_path $HOME/.dotnet/tools
append_path $HOME/.pyenv/bin
append_path ${KREW_ROOT:-$HOME/.krew}/bin
export PATH=$PATH:$OLDPATH

# This must be before sheldon/ohmhyzsh, otherwise we get warnings
eval "$(pyenv init -)"

ZSH_THEME="agnoster"

HYPHEN_INSENSITIVE="true"
export UPDATE_ZSH_DAYS=5
DISABLE_UPDATE_PROMPT="true"
COMPLETION_WAITING_DOTS="true"
HIST_STAMPS="yyyy-mm-dd"
ZSH_TMUX_AUTOSTART=true


if [[ "$OSTYPE" == "darwin"* ]]; then
  OSXPLUGIN=osx
fi

# now that docker isn't free anymore,
# I can't have it on all my machines :(
if [[ $(command -v docker) ]]; then
  DOCKERPLUGIN=docker
fi

plugins=(
  aws
  command-not-found
  dircycle
  ${DOCKERPLUGIN}
  fzf
  git
  git-extras
  git-prompt
  gitfast
  github
  gpg-agent
  helm
  history
  kubectl
  kubectx
  magic-enter
  ${OSXPLUGIN}
  pyenv
  rbenv
  screen
  sublime
  sublime-merge
  sudo
  virtualenv
  zsh-interactive-cd
)

if [ -d $HOME/.sheldon/repos/github.com/ohmyzsh/ohmyzsh ]; then
  export ZSH=$HOME/.sheldon/repos/github.com/ohmyzsh/ohmyzsh
elif [ -d $HOME/.local/sheldon/repos/github.com/ohmyzsh/ohmyzsh ]; then
  export ZSH=$HOME/.local/sheldon/repos/github.com/ohmyzsh/ohmyzsh ]
elif [ -d $HOME/.oh-my-zsh ]; then
  export ZSH=$HOME/.oh-my-zsh
else
  return
fi

eval "$(sheldon source)"

command -v zsh-defer >/dev/null 2>&1 && RPS1="%F{240}loading%f"

test -e "${HOME}/.iterm2_shell_integration.zsh" && source "${HOME}/.iterm2_shell_integration.zsh"

command -v nvim >/dev/null 2>&1 && export EDITOR='nvim'

if [ $TILIX_ID ] || [ $VTE_VERSION ]; then
  source /etc/profile.d/vte.sh
fi

zsh-defer -c 'unset RPS1'
command -v neofetch >/dev/null 2>&1 && neofetch

export JAVA_TOOLS_OPTIONS="-Dlog4j2.formatMsgNoLookups=true"

if [ $_ZSH_PROFILE ]; then
  zprof
fi

export NVM_DIR="$HOME/.config/nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"  # This loads nvm
[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"  # This loads nvm bash_completion
